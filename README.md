# Hack2025 Frontend - News Aggregator

A modern Next.js 14 application for aggregating and summarizing news from RSS feeds with local AI-powered summarization.

## Features

- **WebSub-first delivery**: Automatic discovery of hubs, background subscription management, fallback polling
- **Semantic feeds**: Built-in JSON Feed (`/api/feed.json`), ActivityStreams outbox (`/api/activitypub/outbox`), and RSS (`/api/rss`)
- **Microformats h-feed**: Main UI exposes h-feed/h-entry microformats for Fediverse and microformats consumers
- **RSS Feed Aggregation**: Collect news from multiple RSS sources in parallel with timeout protection
- **Local Summarization**: Works with OpenAI *or* any OpenAI-compatible LLM (e.g. Ollama) with graceful local fallback
- **Smart Deduplication & Filtering**: Remove duplicates and filter by keywords
- **Real-time Updates**: Auto-refresh feeds at configurable intervals
- **Responsive Design**: Modern UI built with Tailwind CSS
- **Robust Error Handling**: Graceful handling of failed feeds with surfaced warnings

## Tech Stack

- **Framework**: Next.js 14 with App Router
- **Styling**: Tailwind CSS
- **TypeScript**: Full type safety
- **RSS Parsing**: rss-parser library
- **AI Summarization**: OpenAI or Ollama (OpenAI-compatible) with local fallback
- **State Management**: React hooks and local state

## Getting Started

### Prerequisites

- Node.js 20+
- npm or yarn

### Installation

1. Clone the repository:
```bash
git clone <repository-url>
cd hack2025-frontend
```

2. Install dependencies:
```bash
npm install
# or
yarn install
```

3. Copy the environment template and configure:

```bash
cp .env.example .env.local
```

Edit `.env.local` with values similar to the following (values shown below assume an Ollama instance reachable at `http://localhost:11434`):

```env
# Required: public URL for metadata, feeds, and ActivityPub endpoints
NEXT_PUBLIC_SITE_URL=https://news.example.com

# Optional: prefer a specific WebSub hub
NEXT_PUBLIC_WEBSUB_HUB=https://pubsubhubbub.appspot.com/

# Required: base URL used when constructing WebSub callbacks
WEBSUB_CALLBACK_BASE_URL=https://news.example.com

# Summarization (set either OpenAI or Ollama-compatible endpoint)
# Example for Ollama llama3.1 running locally
OPENAI_API_KEY=sk-local
OPENAI_MODEL=llama3.1:8b-instruct-q4_0
OPENAI_BASE_URL=http://localhost:11434/v1

# Optional tuning
SUMMARY_CACHE_TTL_MS=1800000
```

4. Run the development server:
```bash
npm run dev
# or
yarn dev
```

Open [http://localhost:3000](http://localhost:3000) in your browser.

## Usage

1. **Add RSS Feeds**: Paste RSS feed URLs in the textarea (one per line).
2. **Set Keywords**: Add comma-separated keywords to filter articles.
3. **Configure Refresh**: Set auto-refresh interval in minutes.
4. **View Articles**: Browse summarized articles ordered by publication time.
5. **Consume from other clients**:
   - JSON Feed → `GET /api/feed.json`
   - RSS → `GET /api/rss`
   - ActivityStreams outbox → `GET /api/activitypub/outbox`
   - ActivityPub actor → `GET /api/activitypub/actor`

## Local Summarization

Feed summaries are generated by `src/lib/summarizer.ts`. Configuration highlights:

- **OpenAI-compatible**: Works with OpenAI, Ollama (`llama3.1:8b-instruct-q4_0`, etc.), LocalAI, LM Studio — anything exposing the Chat Completions API.
- **Environment-driven**: `OPENAI_BASE_URL` selects the endpoint, `OPENAI_MODEL` and `OPENAI_API_KEY` (dummy for Ollama) define the model. Fallback summarizer kicks in when API is unavailable.
- **Caching**: In-memory cache keyed by model/base URL combination, TTL controlled via `SUMMARY_CACHE_TTL_MS`.

## Project Structure

```
src/
├── app/
│   ├── api/
│   │   ├── rss/route.ts                # RSS endpoint (WebSub-aware)
│   │   ├── feed.json/route.ts          # JSON Feed endpoint
│   │   ├── activitypub/actor/route.ts  # ActivityPub actor document
│   │   ├── activitypub/outbox/route.ts # ActivityStreams collection
│   │   └── websub/callback/route.ts    # WebSub verification + push handler
│   ├── layout.tsx                      # Metadata + feed link tags
│   └── page.tsx                        # Main dashboard with h-feed markup
├── components/ArticleCard.tsx          # Article rendering with h-entry classes
├── lib/
│   ├── feed-utils.ts                   # Filtering/dedup utilities
│   ├── rss-parser.ts                   # Feed parsing + hub discovery
│   ├── site-config.ts                  # Shared constants & helpers
│   └── summarizer.ts                   # Summarization pipeline
├── server/
│   ├── websub.ts                       # Subscription orchestration
│   └── websub-store.ts                 # In-memory WebSub state cache
└── types/index.ts                      # Shared type definitions
```

## Development

### Available Scripts

- `npm run dev` - Start development server
- `npm run build` - Build for production
- `npm run start` - Start production server
- `npm run lint` - Run ESLint
- `npm run lint:fix` - Fix ESLint issues
- `npm run type-check` - Run TypeScript type checking

### Code Quality

- ESLint configuration (`.eslintrc.json`) based on Next.js + Prettier
- TypeScript static analysis (`npm run type-check`)
- Tailwind CSS for consistent styling

## Deployment

Regardless of platform, ensure the application is exposed publicly (HTTPS) so WebSub hubs can reach `/api/websub/callback`.

### Vercel

1. Connect repository to Vercel.
2. Define environment variables (`NEXT_PUBLIC_SITE_URL`, `WEBSUB_CALLBACK_BASE_URL`, etc.) in the dashboard.
3. Deploy (Vercel runs `npm run build` by default).

### Self-hosted / Docker

1. Install dependencies: `npm install`.
2. Build assets: `npm run build`.
3. Start production server: `npm run start` (ensure `NODE_ENV=production`).
4. Use a reverse proxy (Nginx/Caddy) with HTTPS to expose the app publicly.
5. Provide environment variables (see `.env` snippet) when launching the container. Example `docker run` flags:
   ```bash
   docker run -p 3000:3000 \
     -e NEXT_PUBLIC_SITE_URL=https://news.example.com \
     -e WEBSUB_CALLBACK_BASE_URL=https://news.example.com \
     -e OPENAI_BASE_URL=http://ollama:11434/v1 \
     -e OPENAI_MODEL=llama3.1:8b-instruct-q4_0 \
     -e OPENAI_API_KEY=sk-local \
     hack2025-frontend
   ```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests if applicable
5. Submit a pull request

## License

This project is licensed under the MIT License.
